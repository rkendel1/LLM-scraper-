<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>🚀 LLM Scraper API Tester</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"  rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; }
    pre { white-space: pre-wrap; word-break: break-word; background: #212529; color: #fff; padding: 10px; border-radius: 5px; }
    .log-entry { font-size: 0.8rem; margin-bottom: 10px; }
  </style>
</head>
<body>
  <div class="container py-4">
    <h1 class="mb-4 text-center">🚀 LLM Scraper API Tester</h1>

    <!-- Tabs -->
    <ul class="nav nav-tabs" id="apiTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="crawl-tab" data-bs-toggle="tab" data-bs-target="#crawl" type="button">🕷️ Crawl</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="rag-tab" data-bs-toggle="tab" data-bs-target="#rag" type="button">🤖 RAG</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="user-tab" data-bs-toggle="tab" data-bs-target="#user" type="button">👤 User</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="auth-tab" data-bs-toggle="tab" data-bs-target="#auth" type="button">🔐 Auth</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="upload-tab" data-bs-toggle="tab" data-bs-target="#upload" type="button">📤 Upload</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="graph-tab" data-bs-toggle="tab" data-bs-target="#graph" type="button">🌐 Graph</button>
      </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content mt-3">

      <!-- Spider Tab -->
      <div class="tab-pane fade show active" id="crawl">
        <div class="card p-3 mb-3">
          <h5>Start Crawl</h5>
          <input type="text" id="crawl-domain" placeholder="Domain" class="form-control mb-2">
          <input type="number" id="crawl-depth" value="2" class="form-control mb-2">
          <button onclick="startCrawl()" class="btn btn-primary">Start</button>
          <button onclick="stopCrawl()" class="btn btn-danger mt-2">Stop</button>
          <pre id="crawl-response"></pre>
        </div>
      </div>

      <!-- RAG Tab -->
      <div class="tab-pane fade" id="rag">
        <div class="card p-3 mb-3">
          <h5>Ask RAG Question</h5>
          <input type="text" id="rag-question" placeholder="Your question" class="form-control mb-2">
          <input type="text" id="rag-user-id" placeholder="User ID (optional)" class="form-control mb-2">
          <button onclick="askQuestion()" class="btn btn-success">Ask</button>
          <pre id="rag-response"></pre>
        </div>
      </div>

      <!-- User Tab -->
      <div class="tab-pane fade" id="user">
        <div class="card p-3 mb-3">
          <h5>User Profile</h5>
          <input type="text" id="get-profile-id" placeholder="User ID" class="form-control mb-2">
          <button onclick="getProfile()" class="btn btn-info">Get Profile</button>
          <pre id="profile-response"></pre>
        </div>
      </div>

      <!-- Auth Tab -->
      <div class="tab-pane fade" id="auth">
        <div class="card p-3 mb-3">
          <h5>Register</h5>
          <input type="email" id="reg-email" placeholder="Email" class="form-control mb-2">
          <input type="password" id="reg-password" placeholder="Password" class="form-control mb-2">
          <button onclick="registerUser()" class="btn btn-primary">Register</button>
        </div>
      </div>

      <!-- Upload Tab -->
      <div class="tab-pane fade" id="upload">
        <div class="card p-3 mb-3">
          <h5>Upload Files</h5>
          <input type="file" id="file-input" multiple class="form-control mb-2">
          <button onclick="uploadFiles()" class="btn btn-secondary">Upload</button>
          <pre id="upload-response"></pre>
        </div>
      </div>

      <!-- Graph Tab -->
      <div class="tab-pane fade" id="graph">
        <div class="card p-3 mb-3">
          <h5>View Ontology Graph</h5>
          <input type="text" id="graph-domain" placeholder="Domain" class="form-control mb-2">
          <button onclick="viewGraph()" class="btn btn-warning">Load Graph</button>
          <iframe id="graph-frame" width="100%" height="400" style="border: none;"></iframe>
        </div>
      </div>

    </div>

    <!-- Logs Section -->
    <div class="mt-4">
      <h5>Request Log</h5>
      <div id="request-log" style="max-height: 300px; overflow-y: auto;"></div>
    </div>
  </div>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> 
  <script>
    function logRequest(method, url, data, response) {
      const entry = `<div class="log-entry"><strong>[${new Date().toISOString()}]</strong> ${method} ${url}<br/>
        <em>Request:</em> ${JSON.stringify(data)}<br/>
        <em>Response:</em> ${JSON.stringify(response)}
      </div>`;
      document.getElementById('request-log').innerHTML = entry + document.getElementById('request-log').innerHTML;
    }

    async function fetchData(url, method = 'POST', body = {}) {
      try {
        const res = await fetch(url, {
          method,
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });
        return await res.json();
      } catch (err) {
        console.error(err);
        return { error: err.message };
      }
    }

    async function startCrawl() {
      const domain = document.getElementById("crawl-domain").value;
      const depth = parseInt(document.getElementById("crawl-depth").value);
      const res = await fetchData("/start-crawl", "POST", { domain, depth });
      document.getElementById("crawl-response").textContent = JSON.stringify(res, null, 2);
      logRequest("POST", "/start-crawl", { domain, depth }, res);
    }

    async function stopCrawl() {
      const res = await fetchData("/stop-crawl", "POST");
      document.getElementById("crawl-response").textContent = JSON.stringify(res, null, 2);
      logRequest("POST", "/stop-crawl", {}, res);
    }

    async function askQuestion() {
      const question = document.getElementById("rag-question").value;
      const user_id = document.getElementById("rag-user-id").value;
      const res = await fetchData("/rag/ask", "POST", { question, user_id });
      document.getElementById("rag-response").textContent = JSON.stringify(res, null, 2);
      logRequest("POST", "/rag/ask", { question, user_id }, res);
    }

    async function registerUser() {
      const email = document.getElementById("reg-email").value;
      const password = document.getElementById("reg-password").value;
      const res = await fetchData("/auth/register", "POST", { email, password });
      logRequest("POST", "/auth/register", { email, password }, res);
    }

    async function getProfile() {
      const user_id = document.getElementById("get-profile-id").value;
      const res = await fetchData("/user/profile", "POST", { user_id });
      document.getElementById("profile-response").textContent = JSON.stringify(res, null, 2);
      logRequest("POST", "/user/profile", { user_id }, res);
    }

    async function uploadFiles() {
      const files = Array.from(document.getElementById("file-input").files);
      const formData = new FormData();
      files.forEach(file => formData.append("files", file));
      
      const res = await fetch("/upload", {
        method: "POST",
        body: formData
      }).then(r => r.json());
      document.getElementById("upload-response").textContent = JSON.stringify(res, null, 2);
      logRequest("POST", "/upload", files.map(f => f.name), res);
    }

    function viewGraph() {
      const domain = document.getElementById("graph-domain").value;
      document.getElementById("graph-frame").src = `/graph/${domain}`;
    }
  </script>
</body>
</html>
